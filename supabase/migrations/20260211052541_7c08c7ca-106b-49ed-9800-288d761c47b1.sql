
CREATE TABLE public.green_card_perm_cases (
    record_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    CASE_NUMBER TEXT,
    CASE_STATUS TEXT,
    RECEIVED_DATE DATE,
    DECISION_DATE DATE,
    REFILE TEXT,
    ORIG_FILE_DATE DATE,
    PREVIOUS_SWA_CASE_NUMBER_STATE TEXT,
    SCHD_A_SHEEPHERDER TEXT,
    EMPLOYER_NAME TEXT,
    EMPLOYER_ADDRESS_1 TEXT,
    EMPLOYER_ADDRESS_2 TEXT,
    EMPLOYER_CITY TEXT,
    EMPLOYER_STATE_PROVINCE TEXT,
    EMPLOYER_COUNTRY TEXT,
    EMPLOYER_POSTAL_CODE TEXT,
    EMPLOYER_PHONE TEXT,
    EMPLOYER_PHONE_EXT TEXT,
    EMPLOYER_NUM_EMPLOYEES INTEGER,
    EMP_YEAR_COMMENCED_BUSINESS INTEGER,
    EMPLOYER_FEIN TEXT,
    NAICS_CODE TEXT,
    FW_OWNERSHIP_INTEREST TEXT,
    EMP_CONTACT_NAME TEXT,
    EMP_CONTACT_ADDRESS_1 TEXT,
    EMP_CONTACT_ADDRESS_2 TEXT,
    EMP_CONTACT_CITY TEXT,
    EMP_CONTACT_STATE_PROVINCE TEXT,
    EMP_CONTACT_COUNTRY TEXT,
    EMP_CONTACT_POSTAL_CODE TEXT,
    EMP_CONTACT_PHONE TEXT,
    EMP_CONTACT_EMAIL TEXT,
    AGENT_ATTORNEY_NAME TEXT,
    AGENT_ATTORNEY_FIRM_NAME TEXT,
    AGENT_ATTORNEY_PHONE TEXT,
    AGENT_ATTORNEY_PHONE_EXT TEXT,
    AGENT_ATTORNEY_ADDRESS_1 TEXT,
    AGENT_ATTORNEY_ADDRESS_2 TEXT,
    AGENT_ATTORNEY_CITY TEXT,
    AGENT_ATTORNEY_STATE_PROVINCE TEXT,
    AGENT_ATTORNEY_COUNTRY TEXT,
    AGENT_ATTORNEY_POSTAL_CODE TEXT,
    AGENT_ATTORNEY_EMAIL TEXT,
    PW_TRACK_NUMBER TEXT,
    PW_SOC_CODE TEXT,
    PW_SOC_TITLE TEXT,
    PW_SKILL_LEVEL TEXT,
    PW_WAGE NUMERIC(12,2),
    PW_UNIT_OF_PAY TEXT,
    PW_WAGE_SOURCE TEXT,
    PW_SOURCE_NAME_OTHER TEXT,
    PW_DETERMINATION_DATE DATE,
    PW_EXPIRATION_DATE DATE,
    WAGE_OFFER_FROM NUMERIC(12,2),
    WAGE_OFFER_TO NUMERIC(12,2),
    WAGE_OFFER_UNIT_OF_PAY TEXT,
    WORKSITE_ADDRESS_1 TEXT,
    WORKSITE_ADDRESS_2 TEXT,
    WORKSITE_CITY TEXT,
    WORKSITE_STATE TEXT,
    WORKSITE_POSTAL_CODE TEXT,
    JOB_TITLE TEXT,
    MINIMUM_EDUCATION TEXT,
    JOB_EDUCATION_MIN_OTHER TEXT,
    MAJOR_FIELD_OF_STUDY TEXT,
    REQUIRED_TRAINING TEXT,
    REQUIRED_TRAINING_MONTHS INTEGER,
    REQUIRED_FIELD_OF_TRAINING TEXT,
    REQUIRED_EXPERIENCE TEXT,
    REQUIRED_EXPERIENCE_MONTHS INTEGER,
    ACCEPT_ALT_FIELD_OF_STUDY TEXT,
    ACCEPT_ALT_MAJOR_FLD_OF_STUDY TEXT,
    ACCEPT_ALT_COMBO TEXT,
    ACCEPT_ALT_COMBO_EDUCATION TEXT,
    ACCEPT_ALT_COMBO_ED_OTHER TEXT,
    ACCEPT_ALT_COMBO_EDUCATION_YRS INTEGER,
    ACCEPT_FOREIGN_EDUCATION TEXT,
    ACCEPT_ALT_OCCUPATION TEXT,
    ACCEPT_ALT_OCCUPATION_MONTHS INTEGER,
    ACCEPT_ALT_JOB_TITLE TEXT,
    JOB_OPP_REQUIREMENTS_NORMAL TEXT,
    FOREIGN_LANGUAGE_REQUIRED TEXT,
    SPECIFIC_SKILLS TEXT,
    COMBINATION_OCCUPATION TEXT,
    OFFERED_TO_APPL_FOREIGN_WORKER TEXT,
    FOREIGN_WORKER_LIVE_ON_PREM TEXT,
    FOREIGN_WORKER_LIVE_IN_DOM_SER TEXT,
    FOREIGN_WORKER_LIVE_IN_DOM_SVC_CNT INTEGER,
    PROFESSIONAL_OCCUPATION TEXT,
    APP_FOR_COLLEGE_U_TEACHER TEXT,
    COMPETITIVE_PROCESS TEXT,
    BASIC_RECRUITMENT_PROCESS TEXT,
    TEACHER_SELECT_DATE DATE,
    TEACHER_PUB_JOURNAL_NAME TEXT,
    ADD_RECRUIT_INFORMATION TEXT,
    SWA_JOB_ORDER_START_DATE DATE,
    SWA_JOB_ORDER_END_DATE DATE,
    SUNDAY_EDITION_NEWSPAPER TEXT,
    FIRST_NEWSPAPER_NAME TEXT,
    FIRST_ADVERTISEMENT_START_DATE DATE,
    SECOND_NEWSPAPER_AD_NAME TEXT,
    SECOND_ADVERTISEMENT_TYPE TEXT,
    SECOND_AD_START_DATE DATE,
    JOB_FAIR_FROM_DATE DATE,
    JOB_FAIR_TO_DATE DATE,
    ON_CAMPUS_RECRUITING_FROM_DATE DATE,
    ON_CAMPUS_RECRUITING_TO_DATE DATE,
    EMPLOYER_WEBSITE_FROM_DATE DATE,
    EMPLOYER_WEBSITE_TO_DATE DATE,
    PRO_ORG_AD_FROM_DATE DATE,
    PRO_ORG_ADVERTISEMENT_TO_DATE DATE,
    JOB_SEARCH_WEBSITE_FROM_DATE DATE,
    JOB_SEARCH_WEBSITE_TO_DATE DATE,
    PVT_EMPLOYMENT_FIRM_FROM_DATE DATE,
    PVT_EMPLOYMENT_FIRM_TO_DATE DATE,
    EMPLOYEE_REF_PROG_FROM_DATE DATE,
    EMPLOYEE_REFERRAL_PROG_TO_DATE DATE,
    CAMPUS_PLACEMENT_FROM_DATE DATE,
    CAMPUS_PLACEMENT_TO_DATE DATE,
    LOCAL_ETHNIC_PAPER_FROM_DATE DATE,
    LOCAL_ETHNIC_PAPER_TO_DATE DATE,
    RADIO_TV_AD_FROM_DATE DATE,
    RADIO_TV_AD_TO_DATE DATE,
    EMP_RECEIVED_PAYMENT TEXT,
    PAYMENT_DETAILS TEXT,
    BARGAINING_REP_NOTIFIED TEXT,
    POSTED_NOTICE_AT_WORKSITE TEXT,
    LAYOFF_IN_PAST_SIX_MONTHS TEXT,
    US_WORKERS_CONSIDERED TEXT,
    COUNTRY_OF_CITIZENSHIP TEXT,
    FOREIGN_WORKER_BIRTH_COUNTRY TEXT,
    CLASS_OF_ADMISSION TEXT,
    FOREIGN_WORKER_EDUCATION TEXT,
    FOREIGN_WORKER_EDUCATION_OTHER TEXT,
    FOREIGN_WORKER_INFO_MAJOR TEXT,
    FOREIGN_WORKER_YRS_ED_COMP INTEGER,
    FOREIGN_WORKER_INST_OF_ED TEXT,
    FOREIGN_WORKER_ED_INST_ADD_1 TEXT,
    FOREIGN_WORKER_ED_INST_ADD_2 TEXT,
    FOREIGN_WORKER_ED_INST_CITY TEXT,
    FOREIGN_WORKER_ED_INST_STATE_P TEXT,
    FOREIGN_WORKER_ED_INST_COUNTRY TEXT,
    FOREIGN_WORKER_ED_INST_POST_CD TEXT,
    FOREIGN_WORKER_TRAINING_COMP TEXT,
    FOREIGN_WORKER_REQ_EXPERIENCE TEXT,
    FOREIGN_WORKER_ALT_ED_EXP TEXT,
    FOREIGN_WORKER_ALT_OCC_EXP TEXT,
    FOREIGN_WORKER_EXP_WITH_EMPL TEXT,
    FOREIGN_WORKER_EMPL_PAY_FOR_ED TEXT,
    FOREIGN_WORKER_CURR_EMPLOYED TEXT,
    EMPLOYER_COMPLETED_APPLICATION TEXT,
    PREPARER_NAME TEXT,
    PREPARER_TITLE TEXT,
    PREPARER_EMAIL TEXT,
    EMP_INFO_DECL_NAME TEXT,
    EMP_DECL_TITLE TEXT,
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Enable RLS
ALTER TABLE public.green_card_perm_cases ENABLE ROW LEVEL SECURITY;

-- Public read-only access
CREATE POLICY "Allow public read access to PERM cases"
ON public.green_card_perm_cases
FOR SELECT
USING (true);

-- Indexes for common search patterns
CREATE INDEX idx_perm_employer_name ON public.green_card_perm_cases USING GIN (to_tsvector('english', EMPLOYER_NAME));
CREATE INDEX idx_perm_job_title ON public.green_card_perm_cases USING GIN (to_tsvector('english', JOB_TITLE));
CREATE INDEX idx_perm_worksite_state ON public.green_card_perm_cases (WORKSITE_STATE);
CREATE INDEX idx_perm_worksite_city ON public.green_card_perm_cases (WORKSITE_CITY);
CREATE INDEX idx_perm_case_status ON public.green_card_perm_cases (CASE_STATUS);
CREATE INDEX idx_perm_wage_from ON public.green_card_perm_cases (WAGE_OFFER_FROM);
CREATE INDEX idx_perm_soc_code ON public.green_card_perm_cases (PW_SOC_CODE);
CREATE INDEX idx_perm_soc_title ON public.green_card_perm_cases USING GIN (to_tsvector('english', PW_SOC_TITLE));
CREATE INDEX idx_perm_decision_date ON public.green_card_perm_cases (DECISION_DATE);
CREATE INDEX idx_perm_country_citizenship ON public.green_card_perm_cases (COUNTRY_OF_CITIZENSHIP);
